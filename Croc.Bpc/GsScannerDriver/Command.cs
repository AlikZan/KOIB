using System; 

 

 

namespace Croc.Bpc.GsScannerDriver 

{ 

	/// <summary> 

	/// ??????? ? ?????? 

	/// </summary> 

	struct comlen 

	{ 

		/// <summary> 

		/// ??????????????? ??????? ?? ??????? ???? 

		/// </summary> 

		/// <param name="data">??????, ??????????? ?? ?????? ??????</param> 

		public comlen(byte[] data) 

		{ 

			// ?????? ?? ??????????? ?????????? ?? 4? ?????? 

			// ??????? ????? ???????? ? ??????? ????????? 

			this.CommandID = 

				data[0] 

				| data[1] << 8 

				| data[2] << 16 

				| data[3] << 24; 

			this.datalen = 

				data[4] 

				| data[5] << 8 

				| data[6] << 16 

				| data[7] << 24; 

		} 

 

 

		/// <summary> 

		/// ???????????? ?????? ??? ???????? 

		/// </summary> 

		/// <returns>????? ??? ?????? ? ????? ??????</returns> 

		public byte[] data() 

		{ 

			// ?????? ????????? ???? ????????? ?? 4 ???????????? ??? ????? 

			// ??????? ????? ???????? ? ??????? ????????? 

			byte[] buf = new byte[8]; 

			int i = CommandID; 

			buf[0] = (byte)( i & 0xFF); 

			buf[1] = (byte)(( i >> 8 ) & 0xFF); 

			buf[2] = (byte)(( i >> 16 ) & 0xFF); 

			buf[3] = (byte)( i >> 24 ); 

			i = datalen; 

			buf[4] = (byte)( i & 0xFF); 

			buf[5] = (byte)(( i >> 8 ) & 0xFF); 

			buf[6] = (byte)(( i >> 16 ) & 0xFF); 

			buf[7] = (byte)( i >> 24 ); 


			return buf; 

		} 

 

 

		/// <summary> 

		/// ????????????? ??????? 

		/// </summary> 

		public int CommandID; 

 

 

		/// <summary> 

		/// ????? ?????? ??????? 

		/// </summary> 

		public int datalen; 

	} 

 

 

	/// <summary> 

	/// ??? ??????? 

	/// </summary> 

	public enum Command : int 

	{ 

		/// <summary> 

		/// ??? ??????? 

		/// </summary> 

		None			= 0x0000, 

 

 

		/// <summary> 

		/// ???????????? 

		/// </summary> 

		umConnect		= 0x1000, 

 

 

		/// <summary> 

		/// ??????????? 

		/// </summary> 

		umDisconnect	= 0x1001, 

 

 

		/// <summary> 

		/// ?????????? ??????? 

		/// </summary> 

		umMotor			= 0x1002, 

 

 

		/// <summary> 

		/// ???????? ???????? 

		/// </summary> 

		umGetProps		= 0x1003, 


 
 

		/// <summary> 

		/// ?????????? ???????? 

		/// </summary> 

		umSetProps		= 0x1004, 

 

 

		/// <summary> 

		/// ???????? ????????? 

		/// </summary> 

		umDrop			= 0x1005, 

 

 

		/// <summary> 

		/// ???????? ????????? ????????? 

		/// </summary> 

		umGetManufProps	= 0x1006, 

 

 

		/// <summary> 

		/// ???????? ????????? ????????? 

		/// </summary> 

		umSetManufProps	= 0x1007, 

 

 

		/// <summary> 

		/// ???????? ???????????? ?????? 

		/// </summary> 

		umGetWhiteCoef	= 0x1008, 

 

 

		/// <summary> 

		/// ?????????? ???????????? ?????? 

		/// </summary> 

		umSetWhiteCoef	= 0x1009, 

 

 

		/// <summary> 

		/// ??????????????? 

		/// </summary> 

		umPing			= 0x100A, 

 

 

		/// <summary> 

		/// ???????? ??????????????? ??????? ?????? 

		/// ?? ????????????. ? ????????? ?? ???????????. ??? ??????? ?????????? ?? ????? ?????? 

		/// </summary> 

		umScanGrayArea	= 0x100B, 

 


 
		/// <summary> 

		/// ???????? ??????????????? ?????-????? ??????? 

		/// ?? ????????????. ? ????????? ?? ???????????. ??? ??????? ?????????? ?? ????? ?????? 

		/// </summary> 

		umScanBinArea	= 0x100C, 

 

 

		/// <summary> 

		/// ?????????? ??????????? 

		/// </summary> 

		umIndicator		= 0x100D, 

 

 

		/// <summary> 

		/// ?????????? ??????? ?????????? 

		/// </summary> 

		umIndicatorS	= 0x100E, 

 

 

		/// <summary> 

		/// ?????????? ?????????? ??????? ?????? 

		/// </summary> 

		umSetFormats	= 0x100F, 

 

 

		/// <summary> 

		/// ?????????? ?????????? ??????? 

		/// </summary> 

		umSetPageOffset	= 0x1010, 

 

 

		/// <summary> 

		/// ????????????? ????????? 

		/// </summary> 

		umRevers		= 0x1011, 

 

 

		/// <summary> 

		/// ?????????????? ????? 

		/// </summary> 

		umTestMarker	= 0x1012, 

 

 

		/// <summary> 

		/// ????????? ??????, ?????????? ?? ????????? ?? ????? ???????????? 

		/// </summary> 

		umScanIndicator	= 0x1013, 

 

 


		/// <summary> 

		/// ????????? ?????? ????????? 

		/// </summary> 

		umGetVersion	= 0x1014, 

 

 

		/// <summary> 

		/// ????????? ??????????? ??????????? 

		/// ?? ????????????. ? ????????? ?? ???????????. ?????????? ???????????? ?? ??????????? ??????. 

		/// </summary> 

		umSaveHalftone	= 0x1015, 

 

 

		/// <summary> 

		/// ????????? ???????? ??????????? 

		/// ?? ????????????. ? ????????? ?? ???????????. ?????????? ???????????? ?? ??????????? ??????. 

		/// </summary> 

		umSaveBinary	= 0x1016, 

 

 

		/// <summary> 

		/// ???????????? ????????? ???? 

		/// </summary> 

		umRestoreLamps	= 0x1017, 

 

 

		/// <summary> 

		/// ?????????? ??????? ??????? (??????????? ? ??????????????) ??? 

		/// </summary> 

		umSetWorkZone	= 0x1018, 

 

 

		/// <summary> 

		/// ???????? ???????? ??????? ???????? ????? ?????????? ???????????????? ????????? 

		/// </summary> 

		umGetDoubleSheetSensorLastScanValue	= 0x1019, 

 

 

		/// <summary> 

		/// ?? ???????????? 

		/// </summary> 

		umGetSoundVolume					= 0x101A, 

 

 

		/// <summary> 

		/// ?? ???????????? 

		/// </summary> 

		umSetSoundVolume					= 0x101B, 

 

 


		/// <summary> 

		/// ?????????? ????????? ???????? ??????? ???????? ????? 

		/// </summary> 

		umSetDoubleSheetSensorCurrentLevel	= 0x101C, 

 

 

		/// <summary> 

		/// ????????? ??????? ??????? ???????? ????? 

		/// </summary> 

		umCheckDoubleSheetSensor			= 0x101D, 

 

 

 

 

		/// <summary> 

		/// ???? ??????? 

		/// </summary> 

		msEvent			= 0x8000, 

 

 

		/// <summary> 

		/// ??????? ?????????? ? ?????????? 

		/// </summary> 

		umWantToConnect	= msEvent | 1, 

 

 

		/// <summary> 

		/// ??????? ?????? ?????????? ?????????? 

		/// </summary> 

		umDebugLine		= msEvent | 2, 

 

 

		/// <summary> 

		/// ??????? ???????????? ?????????? 

		/// </summary> 

		umConnected		= msEvent | 3, 

 

 

		/// <summary> 

		/// ??????? ?????? ??????????? ???????? 

		/// </summary> 

		umPageIn		= msEvent | 6, 

 

 

		/// <summary> 

		/// ??????? ????????? ?? ????????? ??????????????? ?????? ? ???????? 

		/// (????????? ? ?????????? ????????? ???????) 

		/// </summary> 

		umScanDopStrip	= msEvent | 7, 

 


 
		/// <summary> 

		/// ??????? ????????? ?? ????????? ??????????????? ?????? ? ?????-????? ???????? 

		/// (????????? ? ?????????? ???????) 

		/// </summary> 

		umScanBinStrip	= msEvent | 8, 

 

 

		/// <summary> 

		/// ??????? ?????? 

		/// </summary> 

		umError			= msEvent | 9, 

 

 

		/// <summary> 

		/// ??????? ?????? ????????? 

		/// </summary> 

		umSheetDroped	= msEvent | 10, 

 

 

		/// <summary> 

		/// ??????? ?????? ?????????? ?????????? 

		/// </summary> 

		umDebugData		= msEvent | 11, 

 

 

		/// <summary> 

		/// ??????? ?????????? ??????? ????? ????????? 

		/// </summary> 

		umReadyToScanning= msEvent | 12 

	} 

 

 

	/// <summary> 

	/// ???????????????? ????????? (??????? ??? ???????) 

	/// </summary> 

	public class UserMessage 

	{ 

		/// <summary> 

		/// ?????? ????????? 

		/// </summary> 

		byte[] data; 

 

 

		/// <summary> 

		/// ????????????? ??????? ??? ??????? 

		/// </summary> 

		Command command; 

 

 


		/// <summary> 

		/// ????????????? ??????? ??? ??????? 

		/// </summary> 

		public Command Command 

		{ 

			get { return command; } 

		} 

 

 

		/// <summary> 

		/// ?????? ????????? 

		/// </summary> 

		public byte[] Data 

		{ 

			get { return data; } 

		} 

 

 

		/// <summary> 

		/// ????????? (???????) ??? ???????? ????????? 

		/// </summary> 

		/// <param name="command">????????????? ???????</param> 

		/// <param name="data">??????</param> 

		public UserMessage( Command command, byte[] data ) 

		{ 

			this.command = command; 

			this.data = data; 

		} 

 

 

		/// <summary> 

		/// ??????????????? ????????? ?? ??????????? ?????? 

		/// </summary> 

		/// <param name="recivedData">?????? ?????????? ?? </param> 

		public UserMessage( byte[] recivedData ) 

		{ 

			// ?????? 4 ????? - ????????????? 

			this.command = (Command) 

				( 

				recivedData[0] 

				| recivedData[1] << 8 

				| recivedData[2] << 16 

				| recivedData[3] << 24); 

			// ????????? 4 ????? - ????? ?????? 

			int dataLen = 

				recivedData[4] 

				| recivedData[5] << 8 

				| recivedData[6] << 16 

				| recivedData[7] << 24; 

			this.data = new byte[dataLen]; 


			// ??????? ? 8-?? ????? ?????????? ?????? 

			Array.Copy( recivedData, 8, data, 0, dataLen ); 

		} 

 

 

		/// <summary> 

		/// ????? ??? ???????? ? ????? ?????? ????????? 

		/// </summary> 

		public byte[] Buffer 

		{ 

			get 

			{ 

				// ????? ????? - 2 ????? ?? 2 ????? + ????? ???????????? ?????? 

				byte[] buf = new byte[ data.Length + 8 ]; 

				int i = unchecked ((int)Command); 

				buf[0] = (byte)( i & 0xFF); 

				buf[1] = (byte)(( i >> 8 ) & 0xFF); 

				buf[2] = (byte)(( i >> 16 ) & 0xFF); 

				buf[3] = (byte)( i >> 24 ); 

				i = data.Length; 

				buf[4] = (byte)( i & 0xFF); 

				buf[5] = (byte)(( i >> 8 ) & 0xFF); 

				buf[6] = (byte)(( i >> 16 ) & 0xFF); 

				buf[7] = (byte)( i >> 24 ); 

				Array.Copy( data, 0, buf, 8, data.Length ); 

				return buf; 

			} 

		} 

	} 

}


